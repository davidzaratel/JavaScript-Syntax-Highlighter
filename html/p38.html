<!DOCTYPE html>
    <html>
    <head>
      <title> Javascript Script Highlighter</title>
      <link rel='stylesheet' href='../css/styles.css'>
    </head>
    <body>
    <h1>Javascript script highlighter</h1>
    <h3> By: David Zarate Lopez A01329795</h3>
    <br>
    <pre><code><span class="identifier">exports</span><span class="signs">.</span><span class="identifier">InitializeData</span><span> </span><span class="signs">=</span><span> </span><span class="reserved">function</span><span> </span><span class="identifier">initialize</span><span class="signs">(</span><span class="identifier">processInd</span><span class="signs">)</span><span> </span><span class="signs">{</span><br><span> </span><span> </span><span class="reserved">var</span><span> </span><span class="identifier">lastupdateDate</span><span> </span><span class="signs">=</span><span> </span><span class="identifier">Ti</span><span class="signs">.</span><span class="identifier">App</span><span class="signs">.</span><span class="identifier">Properties</span><span class="signs">.</span><span class="identifier">getString</span><span class="signs">(</span><span class="string">"lastUpdatedOn"</span><span class="signs">)</span><span class="signs">;</span><br><span> </span><span> </span><span class="reserved">var</span><span> </span><span class="identifier">APIHost</span><span> </span><span class="signs">=</span><span> </span><span class="identifier">Ti</span><span class="signs">.</span><span class="identifier">App</span><span class="signs">.</span><span class="identifier">Properties</span><span class="signs">.</span><span class="identifier">getString</span><span class="signs">(</span><span class="string">"APIHost"</span><span class="signs">)</span><span class="signs">;</span><br><span> </span><span> </span><span class="identifier">APIHost</span><span> </span><span class="signs">=</span><span> </span><span class="string">"http://sum-dev.apphb.com/api"</span><span class="signs">;</span><br><span> </span><span> </span><span class="identifier">Ti</span><span class="signs">.</span><span class="identifier">App</span><span class="signs">.</span><span class="identifier">Properties</span><span class="signs">.</span><span class="identifier">setString</span><span class="signs">(</span><span class="string">"APIHost"</span><span class="signs">,</span><span> </span><span class="identifier">APIHost</span><span class="signs">)</span><span class="signs">;</span><br><br><span> </span><span> </span><span class="reserved">var</span><span> </span><span class="identifier">connectString</span><span class="signs">;</span><br><span> </span><span> </span><span class="reserved">var</span><span> </span><span class="identifier">db</span><span class="signs">;</span><br><span> </span><span> </span><span class="reserved">try</span><span> </span><span class="signs">{</span><br><span> </span><span> </span><span> </span><span> </span><span class="identifier">db</span><span> </span><span class="signs">=</span><span> </span><span class="identifier">Titanium</span><span class="signs">.</span><span class="identifier">Database</span><span class="signs">.</span><span class="identifier">install</span><span class="signs">(</span><span class="string">"/db/myturnerdb.db"</span><span class="signs">,</span><span> </span><span class="string">"myturnerdb"</span><span class="signs">)</span><span class="signs">;</span><br><br><span> </span><span> </span><span> </span><span> </span><span class="reserved">if</span><span> </span><span class="signs">(</span><span class="identifier">lastupdateDate</span><span> </span><span class="signs">=</span><span class="signs">=</span><span class="signs">=</span><span> </span><span class="bool">null</span><span class="signs">)</span><span> </span><span class="signs">{</span><br><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span class="reserved">var</span><span> </span><span class="identifier">sql</span><span> </span><span class="signs">=</span><span> </span><span class="string">"select LastUpdatedOn from UpdateStatus"</span><span class="signs">;</span><br><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span class="reserved">var</span><span> </span><span class="identifier">row</span><span> </span><span class="signs">=</span><span> </span><span class="identifier">db</span><span class="signs">.</span><span class="identifier">execute</span><span class="signs">(</span><span class="identifier">sql</span><span class="signs">)</span><span class="signs">;</span><br><br><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span class="reserved">if</span><span> </span><span class="signs">(</span><span class="identifier">row</span><span class="signs">.</span><span class="identifier">isValidRow</span><span class="signs">(</span><span class="signs">)</span><span class="signs">)</span><span> </span><span class="signs">{</span><br><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span class="identifier">lastupdateDate</span><span> </span><span class="signs">=</span><span> </span><span class="identifier">row</span><span class="signs">.</span><span class="identifier">fieldByName</span><span class="signs">(</span><span class="string">"LastUpdatedOn"</span><span class="signs">)</span><span class="signs">;</span><br><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span class="identifier">Ti</span><span class="signs">.</span><span class="identifier">App</span><span class="signs">.</span><span class="identifier">Properties</span><span class="signs">.</span><span class="identifier">setString</span><span class="signs">(</span><span class="string">"lastUpdatedOn"</span><span class="signs">,</span><span> </span><span class="identifier">lastupdateDate</span><span class="signs">)</span><span class="signs">;</span><br><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span class="identifier">Ti</span><span class="signs">.</span><span class="identifier">API</span><span class="signs">.</span><span class="identifier">info</span><span class="signs">(</span><span class="string">"lastupdated on :"</span><span> </span><span class="signs">+</span><span> </span><span class="identifier">lastupdateDate</span><span class="signs">)</span><span class="signs">;</span><br><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span class="signs">}</span><br><span> </span><span> </span><span> </span><span> </span><span class="signs">}</span><br><br><span> </span><span> </span><span> </span><span> </span><span class="identifier">connectString</span><span> </span><span class="signs">=</span><br><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span class="identifier">APIHost</span><span> </span><span class="signs">+</span><br><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span class="string">"/Person?$filter=ModifiedDateTime gt datetime'"</span><span> </span><span class="signs">+</span><br><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span class="identifier">lastupdateDate</span><span> </span><span class="signs">+</span><br><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span class="string">"'"</span><span class="signs">;</span><br><br><span> </span><span> </span><span> </span><span> </span><span class="reserved">var</span><span> </span><span class="identifier">xhr</span><span> </span><span class="signs">=</span><span> </span><span class="identifier">Titanium</span><span class="signs">.</span><span class="identifier">Network</span><span class="signs">.</span><span class="identifier">createHTTPClient</span><span class="signs">(</span><span class="signs">{</span><br><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span class="identifier">timeout</span><span class="signs">:</span><span> </span><span class="num">20000</span><span class="signs">,</span><br><span> </span><span> </span><span> </span><span> </span><span class="signs">}</span><span class="signs">)</span><span class="signs">;</span><br><br><span> </span><span> </span><span> </span><span> </span><span class="identifier">Ti</span><span class="signs">.</span><span class="identifier">API</span><span class="signs">.</span><span class="identifier">info</span><span class="signs">(</span><span class="identifier">connectString</span><span class="signs">)</span><span class="signs">;</span><br><span> </span><span> </span><span> </span><span> </span><span class="identifier">xhr</span><span class="signs">.</span><span class="identifier">open</span><span class="signs">(</span><span class="string">"GET"</span><span class="signs">,</span><span> </span><span class="identifier">connectString</span><span class="signs">)</span><span class="signs">;</span><br><span> </span><span> </span><span> </span><span> </span><span class="comment">// set Content-Type
</span><span> </span><span> </span><span> </span><span> </span><span class="identifier">xhr</span><span class="signs">.</span><span class="identifier">setRequestHeader</span><span class="signs">(</span><span class="string">"Content-Encoding"</span><span class="signs">,</span><span> </span><span class="string">"gzip"</span><span class="signs">)</span><span class="signs">;</span><br><span> </span><span> </span><span> </span><span> </span><span class="identifier">xhr</span><span class="signs">.</span><span class="identifier">setRequestHeader</span><span class="signs">(</span><span class="string">"accept"</span><span class="signs">,</span><span> </span><span class="string">"application/json"</span><span class="signs">)</span><span class="signs">;</span><br><br><span> </span><span> </span><span> </span><span> </span><span class="identifier">xhr</span><span class="signs">.</span><span class="identifier">onerror</span><span> </span><span class="signs">=</span><span> </span><span class="reserved">function</span><span> </span><span class="signs">(</span><span class="identifier">e</span><span class="signs">)</span><span> </span><span class="signs">{</span><br><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span class="comment">//alert(e.error);
</span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span class="comment">//Ti.API.error("ERROR " + e.error);
</span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span class="identifier">Ti</span><span class="signs">.</span><span class="identifier">App</span><span class="signs">.</span><span class="identifier">fireEvent</span><span class="signs">(</span><span class="string">"app:loadMain"</span><span class="signs">)</span><span class="signs">;</span><br><span> </span><span> </span><span> </span><span> </span><span class="signs">}</span><span class="signs">;</span><br><br><span> </span><span> </span><span> </span><span> </span><span class="identifier">xhr</span><span class="signs">.</span><span class="identifier">onload</span><span> </span><span class="signs">=</span><span> </span><span class="reserved">function</span><span> </span><span class="signs">(</span><span class="signs">)</span><span> </span><span class="signs">{</span><br><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span class="reserved">var</span><span> </span><span class="identifier">json</span><span class="identifier">_data</span><span> </span><span class="signs">=</span><span> </span><span class="identifier">JSON</span><span class="signs">.</span><span class="identifier">parse</span><span class="signs">(</span><span class="identifier">xhr</span><span class="signs">.</span><span class="identifier">responseText</span><span class="signs">)</span><span class="signs">.</span><span class="identifier">value</span><span class="signs">;</span><br><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span class="identifier">Ti</span><span class="signs">.</span><span class="identifier">API</span><span class="signs">.</span><span class="identifier">info</span><span class="signs">(</span><span class="string">"Success "</span><span> </span><span class="signs">+</span><span> </span><span class="identifier">json</span><span class="identifier">_data</span><span class="signs">.</span><span class="identifier">length</span><span class="signs">)</span><span class="signs">;</span><br><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span class="comment">//open db
</span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span class="comment">// Ti.API.info(getCurrentDate());
</span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span class="comment">//db.file.setRemoteBackup(false);
</span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span class="reserved">if</span><span> </span><span class="signs">(</span><span class="identifier">db</span><span> </span><span class="signs">!</span><span class="signs">=</span><span> </span><span class="bool">null</span><span class="signs">)</span><span> </span><span class="signs">{</span><br><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span class="reserved">for</span><span> </span><span class="signs">(</span><span class="reserved">var</span><span> </span><span class="identifier">i</span><span> </span><span class="signs">=</span><span> </span><span class="num">0</span><span class="signs">;</span><span> </span><span class="identifier">i</span><span> </span><span class="signs"><</span><span> </span><span class="identifier">json</span><span class="identifier">_data</span><span class="signs">.</span><span class="identifier">length</span><span class="signs">;</span><span> </span><span class="identifier">i</span><span class="signs">+</span><span class="signs">+</span><span class="signs">)</span><span> </span><span class="signs">{</span><br><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span class="reserved">if</span><span> </span><span class="signs">(</span><span class="identifier">processInd</span><span class="signs">)</span><span> </span><span class="signs">{</span><br><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span class="identifier">processInd</span><span class="signs">.</span><span class="identifier">message</span><span> </span><span class="signs">=</span><span> </span><span class="identifier">json</span><span class="identifier">_data</span><span class="signs">.</span><span class="identifier">length</span><span> </span><span class="signs">-</span><span> </span><span class="identifier">i</span><span> </span><span class="signs">+</span><span> </span><span class="string">" remaining.."</span><span class="signs">;</span><br><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span class="signs">}</span><br><br><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span class="identifier">InsertUpdateRow</span><span class="signs">(</span><span class="identifier">json</span><span class="identifier">_data</span><span class="signs">[</span><span class="identifier">i</span><span class="signs">]</span><span class="signs">,</span><span> </span><span class="identifier">db</span><span class="signs">)</span><span class="signs">;</span><br><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span class="signs">}</span><br><br><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span class="reserved">if</span><span> </span><span class="signs">(</span><span class="identifier">processInd</span><span class="signs">)</span><span> </span><span class="signs">{</span><br><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span class="identifier">processInd</span><span class="signs">.</span><span class="identifier">message</span><span> </span><span class="signs">=</span><span> </span><span class="string">"Init DB Complete.."</span><span class="signs">;</span><br><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span class="signs">}</span><br><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span class="comment">//db.open();
</span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span class="comment">//db.execute("BEGIN TRANSACTION");
</span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span class="reserved">try</span><span> </span><span class="signs">{</span><br><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span class="identifier">db</span><span class="signs">.</span><span class="identifier">execute</span><span class="signs">(</span><br><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span class="string">"update UpdateStatus set LastUpdatedOn='"</span><span> </span><span class="signs">+</span><span> </span><span class="identifier">ModifiedOnDate</span><span class="signs">(</span><span class="signs">)</span><span> </span><span class="signs">+</span><span> </span><span class="string">"'"</span><br><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span class="signs">)</span><span class="signs">;</span><br><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span class="signs">}</span><span> </span><span class="reserved">catch</span><span> </span><span class="signs">(</span><span class="identifier">err</span><span class="signs">)</span><span> </span><span class="signs">{</span><br><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span class="identifier">Ti</span><span class="signs">.</span><span class="identifier">API</span><span class="signs">.</span><span class="identifier">info</span><span class="signs">(</span><span class="string">"Error Updating data "</span><span class="signs">)</span><span class="signs">;</span><br><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span class="signs">}</span><br><br><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span class="comment">//db.execute("COMMIT");
</span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span class="comment">//db.close();
</span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span class="identifier">Ti</span><span class="signs">.</span><span class="identifier">API</span><span class="signs">.</span><span class="identifier">info</span><span class="signs">(</span><span class="string">"db updated :"</span><span> </span><span class="signs">+</span><span> </span><span class="identifier">ModifiedOnDate</span><span class="signs">(</span><span class="signs">)</span><span class="signs">)</span><span class="signs">;</span><br><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span class="identifier">Ti</span><span class="signs">.</span><span class="identifier">App</span><span class="signs">.</span><span class="identifier">Properties</span><span class="signs">.</span><span class="identifier">setString</span><span class="signs">(</span><span class="string">"lastUpdatedOn"</span><span class="signs">,</span><span> </span><span class="identifier">ModifiedOnDate</span><span class="signs">(</span><span class="signs">)</span><span class="signs">)</span><span class="signs">;</span><br><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span class="identifier">Ti</span><span class="signs">.</span><span class="identifier">App</span><span class="signs">.</span><span class="identifier">fireEvent</span><span class="signs">(</span><span class="string">"app:loadMain"</span><span class="signs">)</span><span class="signs">;</span><br><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span class="signs">}</span><span> </span><span class="reserved">else</span><span> </span><span class="signs">{</span><br><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span class="comment">//alert('db is null');
</span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span class="signs">}</span><br><span> </span><span> </span><span> </span><span> </span><span class="signs">}</span><span class="signs">;</span><br><br><span> </span><span> </span><span> </span><span> </span><span class="identifier">xhr</span><span class="signs">.</span><span class="identifier">onreadystatechange</span><span> </span><span class="signs">=</span><span> </span><span class="reserved">function</span><span> </span><span class="signs">(</span><span class="identifier">aEvt</span><span class="signs">)</span><span> </span><span class="signs">{</span><br><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span class="reserved">if</span><span> </span><span class="signs">(</span><span class="identifier">xhr</span><span class="signs">.</span><span class="identifier">readyState</span><span> </span><span class="signs">=</span><span class="signs">=</span><span> </span><span class="num">4</span><span class="signs">)</span><span> </span><span class="signs">{</span><br><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span class="reserved">if</span><span> </span><span class="signs">(</span><span class="identifier">xhr</span><span class="signs">.</span><span class="identifier">status</span><span> </span><span class="signs">=</span><span class="signs">=</span><span> </span><span class="num">200</span><span class="signs">)</span><span> </span><span class="signs">{</span><br><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span class="comment">// Titanium.API.debug("status 200 ");
</span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span class="signs">}</span><br><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span class="signs">}</span><br><span> </span><span> </span><span> </span><span> </span><span class="signs">}</span><span class="signs">;</span><br><br><span> </span><span> </span><span> </span><span> </span><span class="identifier">xhr</span><span class="signs">.</span><span class="identifier">send</span><span class="signs">(</span><span class="signs">{</span><span class="signs">}</span><span class="signs">)</span><span class="signs">;</span><br><span> </span><span> </span><span class="signs">}</span><span> </span><span class="reserved">catch</span><span> </span><span class="signs">(</span><span class="identifier">err</span><span class="signs">)</span><span> </span><span class="signs">{</span><br><span> </span><span> </span><span> </span><span> </span><span class="identifier">Ti</span><span class="signs">.</span><span class="identifier">App</span><span class="signs">.</span><span class="identifier">fireEvent</span><span class="signs">(</span><span class="string">"app:loadMain"</span><span class="signs">)</span><span class="signs">;</span><br><span> </span><span> </span><span class="signs">}</span><br><br><span> </span><span> </span><span class="comment">//db.close();
</span><span class="signs">}</span><span class="signs">;</span><br></code></pre>
    </body>
    </html>